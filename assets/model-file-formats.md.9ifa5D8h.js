import{_ as i,c as a,o as n,ae as e}from"./chunks/framework.Bs1KKA1c.js";const E=JSON.parse('{"title":"Model file formats","description":"","frontmatter":{},"headers":[],"relativePath":"model-file-formats.md","filePath":"model-file-formats.md"}'),p={name:"model-file-formats.md"};function t(l,s,h,k,r,o){return n(),a("div",null,s[0]||(s[0]=[e(`<h1 id="model-file-formats" tabindex="-1">Model file formats <a class="header-anchor" href="#model-file-formats" aria-label="Permalink to &quot;Model file formats&quot;">​</a></h1><p>This section targets developers and rock physics specialists responsible for (re)calibrating model parameter files.</p><p>Model files are used in three contexts: (1) the pressure sensitivity model, (2) the T-Matrix EXP variant, and (3) the T-Matrix PETEC variant. All model files are in <code>pickle</code> format. Examples can be found in the test data sets for <code>fmu-pem</code> in the project GitHub repository under <a href="https://github.com/equinor/fmu-pem/tree/main/tests/data/sim2seis/model" target="_blank" rel="noreferrer"><code>test/data/sim2seis/model</code></a>.</p><h2 id="pressure-model-files" tabindex="-1">Pressure model files <a class="header-anchor" href="#pressure-model-files" aria-label="Permalink to &quot;Pressure model files&quot;">​</a></h2><p>Velocity sensitivity to effective pressure is implemented in the module <a href="https://github.com/equinor/rock-physics-open/blob/main/src/rock_physics_open/equinor_utilities/machine_learning_utilities/exponential_model.py" target="_blank" rel="noreferrer"><code>rock-physics-open</code></a> . As the design supports generic model wrappers, the information is split between two <code>.pkl</code> files:</p><ul><li>Metadata file (model descriptor): keys model_type, pointer to core parameter file (nn_mod), input feature list, label variable and units, optional preprocessing artefact references.</li><li>Parameter file: numerical calibration coefficients (a_factor, b_factor), valid pressure range (model_max_pressure), provenance (description). Briefly define a_factor and b_factor (exponential law coefficients for pressure sensitivity of velocity).</li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os, pickle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">os.chdir(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">/tests/data/sim2seis/model</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Metadata file:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">with</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;carbonate_pressure_model_vs_exp.pkl&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;rb&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fin:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pres_vs_dict </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pickle.load(fin)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> key, value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pres_vs_dict.items():</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">value</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Parameter file:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">with</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;vs_exp_model.pkl&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;rb&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fin:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vs_exp_model_dict </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pickle.load(fin)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> key, value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vs_exp_model_dict.items():</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">value</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>Output</strong>:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Metadata file:</span></span>
<span class="line"><span>model_type: Exponential</span></span>
<span class="line"><span>nn_mod: vs_exp_model.pkl</span></span>
<span class="line"><span>scaler: None</span></span>
<span class="line"><span>ohe: None</span></span>
<span class="line"><span>label_var: VSX</span></span>
<span class="line"><span>label_units: m/s</span></span>
<span class="line"><span>feature_var: [&#39;VSX&#39;, &#39;PEFF_in_situ&#39;, &#39;PEFF_depleted&#39;]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Parameter file:</span></span>
<span class="line"><span>a_factor: 0.09164501</span></span>
<span class="line"><span>b_factor: 8.23144402</span></span>
<span class="line"><span>model_max_pressure: 40.0</span></span>
<span class="line"><span>description: plug-based calibration data</span></span></code></pre></div><h2 id="t-matrix-exp-model" tabindex="-1">T-Matrix EXP model <a class="header-anchor" href="#t-matrix-exp-model" aria-label="Permalink to &quot;T-Matrix EXP model&quot;">​</a></h2><p>The <code>EXP</code> type T-Matrix optimisation contains parameters for mineral properties of carbonate and shale, as well as geometry, connectivity and anisotropic parameters. Note that the mineral properties are given as a fraction of the upper bound in the optimisation process (values near 1.0 indicate convergence at the imposed cap). Calibration is performed in <a href="https://github.com/equinor/rock-physics-open/blob/main/src/rock_physics_open/t_matrix_models/t_matrix_parameter_optimisation_exp.py" target="_blank" rel="noreferrer"><code>rock-physics-open</code></a>.</p><p>Parameter definition:</p><ul><li>f_ani: anisotropy (crack alignment / directional weighting) factor.</li><li>f_con: connectivity (effective fluid communication / crack network) factor.</li><li>alpha_opt: array of pore aspect ratios (e.g. alpha_opt[0] equant / stiff, alpha_opt[1] crack-like).</li><li>v_opt: optimised porosity (or volume fraction parameter; clarify if it is total porosity vs a specific pore system).</li><li>k_carb, mu_carb, rho_carb, etc.: normalised carbonate bulk modulus, shear modulus, density; similarly for shale (k_sh, mu_sh, rho_sh).</li><li>opt_vec: concatenated optimisation vector in parameter order (state vector snapshot).</li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os, pickle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">os.chdir(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">/tests/data/sim2seis/model</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">with</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;t_mat_params_exp.pkl&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;rb&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fin:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    exp_params </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pickle.load(fin)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> key, value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exp_params.items():</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">value</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>Output</strong>:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>well_name: unknown</span></span>
<span class="line"><span>opt_ver: exp</span></span>
<span class="line"><span>f_ani: 0.1931401051312247</span></span>
<span class="line"><span>f_con: 0.0006487365851106763</span></span>
<span class="line"><span>alpha_opt: [0.50024826 0.07042638]</span></span>
<span class="line"><span>v_opt: 0.5016505733981023</span></span>
<span class="line"><span>k_carb: 0.6029058965366181</span></span>
<span class="line"><span>mu_carb: 0.7274039302389138</span></span>
<span class="line"><span>rho_carb: 0.9999862334411195</span></span>
<span class="line"><span>k_sh: 0.9999999999999999</span></span>
<span class="line"><span>mu_sh: 0.9999999999999999</span></span>
<span class="line"><span>rho_sh: 0.9090909090909092</span></span>
<span class="line"><span>opt_vec: [1.93140105e-01 6.48736585e-04 5.00248264e-01 7.04263774e-02</span></span>
<span class="line"><span> 5.01650573e-01 6.02905897e-01 7.27403930e-01 9.99986233e-01</span></span>
<span class="line"><span> 1.00000000e+00 1.00000000e+00 9.09090909e-01]</span></span></code></pre></div><h2 id="t-matrix-petec-model" tabindex="-1">T-Matrix PETEC model <a class="header-anchor" href="#t-matrix-petec-model" aria-label="Permalink to &quot;T-Matrix PETEC model&quot;">​</a></h2><p>The <code>PETEC</code> model type of T-Matrix contains fewer parameters than the <code>EXP</code> model, as in an appraisal or production phase, more detailed information about minerals and fluids is available, and can be applied directly in the modelling. Optimisation code is located in <a href="https://github.com/equinor/rock-physics-open/blob/main/src/rock_physics_open/t_matrix_models/t_matrix_parameter_optimisation_min.py" target="_blank" rel="noreferrer"><code>rock-physics-open</code></a>.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os, pickle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">os.chdir(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">/tests/data/sim2seis/model</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">with</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;t_mat_params_petec.pkl&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;rb&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fin:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    exp_params </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pickle.load(fin)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> key, value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exp_params.items():</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">value</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>Output</strong>:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>well_name: unknown</span></span>
<span class="line"><span>opt_ver: min</span></span>
<span class="line"><span>f_ani: 0.11140201779907752</span></span>
<span class="line"><span>f_con: 0.9999999998567579</span></span>
<span class="line"><span>alpha_opt: [0.5        0.06980489]</span></span>
<span class="line"><span>v_opt: 0.5000000000000977</span></span>
<span class="line"><span>opt_vec: [0.11140202 1.         0.5        0.06980489 0.5       ]</span></span></code></pre></div>`,21)]))}const c=i(p,[["render",t]]);export{E as __pageData,c as default};
